title: "我所理解的分布式事务"
date: 2016-11-25 19:15:20
category: 学海无涯
toc: false
tags: 分布式
---

说到分布式事务，必须提到的就是CAP理论，即同时满足“CAP定律”中的“一致性”、“可用性”和“分区容错性”三者是不可能的；大多数的场景，都需要牺牲强一致性来换取系统的高可用性，系统往往只需要保证“最终一致性”，只要这个最终时间是在用户可以接受的范围内即可；阿里好像有一个GTS分布式事务框架，是做强一致性的，目前行业还未看到有做强一致性方案。

提到分布式系统，必然要提到分布式事务。要想理解分布式事务，不得不先介绍一下两阶段提交协议。先举个简单但不精准的例子来说明：
第一阶段，张老师作为“协调者”，给小强和小明（参与者、节点）发微信，组织他们俩明天8点在学校门口集合，一起去爬山，然后开始等待小强和小明答复。
第二阶段，如果小强和小明都回答没问题，那么大家如约而至。如果小强或者小明其中一人回答说“明天没空，不行”，那么张老师会立即通知小强和小明“爬山活动取消”。
这时候会发现，这个过程中可能有很多问题的。如果小强没看手机，那么张老师会一直等着答复，小明可能在家里把爬山装备都准备好了却一直等着张老师确认信息。更严重的是，如果到明天8点小强还没有答复，那么就算“超时”了，那小明到底去还是不去集合爬山呢？这就是两阶段提交协议的弊病，所以后来业界又引入了三阶段提交协议来解决该类问题。
